<html>
	<head>
		<title>CS755 Cloud Computing Final Project</title>

		<!-- <link href="/cs755final/bootstrap/css/bootstrap.min.css" rel="stylesheet"> -->
		<!-- <link href="/cs755final/css/fileinput.css" rel="stylesheet"> -->
		<link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="/css/fileinput.css" rel="stylesheet">
    
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	    <!-- // <script src="/cs755final/bootstrap/js/bootstrap.min.js"></script> -->
    	<!-- // <script src="/cs755final/js/fileinput.js"></script> -->
	    <script src="/bootstrap/js/bootstrap.min.js"></script>
    	<script src="/js/fileinput.js"></script>

	</head>

	<body>
		<div class="container">
    		<h1 class="page-header">CS755 Cloud Computing Final Project - Demo Page</h1>
			<h3>(Shang-Chih Chiang)</h3>
    		<br/>

    		<h4><strong>Please select a json file generated by my Hadoop program :</strong></h4>
    		<input type="file" id="inputFileUpload" class="file" name="upload_file[]" multiple="true">
			<div id ="inputUploadError"></div>
			<div id="inputUploadSuccess"></div>

			<br/>
			<div id="container" style="height: 500px;"></div>
		</div>

		<script type="text/javascript">
			$("#inputFileUpload").fileinput({
				// uploadUrl: "/cs755final/php/upload.php",
				uploadUrl: "/php/upload.php",
				showCaption: true,
				showPreview: false,
				allowedFileExtensions: ["json"],
				maxFileSize: 10240,
				maxFilesNum: 1,
				elErrorContainer: "#inputUploadError"
			});

			$("#inputFileUpload").on('filebatchuploadsuccess', function(event, data, previewId, index) {
				var form = data.form;
				var files = data.files;
				var extra = data.extra;

				var strSuccess = '';

				strSuccess += '<li>Your file has been successfully uploaded.</li>';
				$("#inputUploadSuccess").html('<div class="alert alert-success" role="alert"><ul class="text-left">' + strSuccess + '</ul></div>');

				$.getJSON("/upload/" + files[0].name).done(function(data) {
					drawChart(data);
				}).fail(function(jqxhr, textStatus, error) {
					var err = textStatus + ", " + error;
					console.log( "Request Failed: " + err );
				});
			});

			$("#inputFileUpload").on('filebrowse', function(event) {
				$("#inputUploadSuccess").html('');
				$("#inputUploadError").html('');
			});

			function drawChart(arrData) {
			    $('#container').highcharts({
			        xAxis: {
			            type: 'datetime',
			            dateTimeLabelFormats: {
			                year: '%Y'
			            }
			        },
			        yAxis: {
			            type: 'linear',
			            title: {
			                text: 'Trade Value ($USD)'
			            },
			            labels: {
			                formatter: function() {    
			                    result = this.value;
			                    if (this.value > 1000000000) { result = Math.floor(this.value / 1000000000) + " B"}
			                    else if (this.value > 1000000) { result = Math.floor(this.value / 1000000) + " M" }
			                    else if (this.value > 1000) { result = Math.floor(this.value / 1000) + " K" }
			                    return result;
			                }
			            }
			        },
			        tooltip: {
			            xDateFormat: '%Y',
			            valuePrefix: '$',
			            pointFormatter: function() {
			                return this.series.name + ': $' + Highcharts.numberFormat(this.y,0,'.',',');
			            }
			        },
			        series: arrData
			        // series: [
			        //     {type: 'column', 
			        //      name: 'USA', 
			        //      data: [
			        //          [1009861200000,42080302610],[1072933200000,50380749334],[1041397200000,46126717376],[1104555600000,55069781610]
			        //      ]
			        //     },
			        // ]

			    });
			}
		</script>
	</body>
</html>